# ------------------------------------------------------
# 1) Python 기반 이미지
# ------------------------------------------------------
FROM python:3.10-slim

# ------------------------------------------------------
# 2) 필수 패키지 설치 (librosa, ffmpeg 등)
# ------------------------------------------------------
RUN apt-get update && apt-get install -y \
    ffmpeg \
    libsndfile1 \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------
# 3) 작업 디렉토리
# ------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------
# 4) requirements 설치
# ------------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ------------------------------------------------------
# 5) FastAPI 코드 + 모델 파일 복사
# ------------------------------------------------------
# ⚠ GitHub에는 모델이 없지만 로컬에서는 있음 → COPY 성공함
COPY app.py .

# 프로젝트 전체 복사 (단, 위에서 복사한 모델 덮어쓰지 않음)
COPY . .

# ------------------------------------------------------
# 6) 포트 설정
# ------------------------------------------------------
EXPOSE 8000

# ------------------------------------------------------
# 7) FastAPI 실행
# ------------------------------------------------------
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
